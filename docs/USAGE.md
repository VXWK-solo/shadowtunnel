# Advanced VPN Server - Руководство по использованию

## Быстрый старт

### 1. Подготовка

Убедитесь, что у вас установлены:
- Python 3.8+
- Ansible 2.9+
- SSH ключи для доступа к серверу

### 2. Настройка конфигурации

Отредактируйте файл `config.cfg`:

```yaml
# Список пользователей
users:
  - phone
  - laptop
  - desktop

# Включенные протоколы
vpn_protocols:
  xray_enabled: true
  v2ray_enabled: false
  shadowsocks_enabled: false
```

### 3. Развертывание

#### На существующем сервере Ubuntu:
```bash
./deploy
# Выберите опцию 9 (Existing Ubuntu server)
# Введите IP адрес сервера
```

#### На облачном провайдере:
```bash
./deploy
# Выберите провайдера (1-8)
# Следуйте инструкциям для ввода API ключей
```

### 4. Получение конфигураций

После успешного развертывания конфигурационные файлы будут в папке `configs/`:

```
configs/
└── <server_ip>/
    ├── vless-phone.json
    ├── vmess-laptop.json
    ├── trojan-desktop.json
    ├── shadowsocks-phone.json
    ├── phone-qr.png
    ├── laptop-qr.png
    └── connection-urls.txt
```

## Поддерживаемые протоколы

### VLESS (рекомендуется)
- Современный протокол без состояния
- Поддержка XTLS для лучшей производительности
- REALITY для обхода DPI

### VMess
- Классический протокол V2Ray
- Хорошая совместимость с клиентами

### Trojan
- Маскировка под HTTPS трафик
- Высокая безопасность

### Shadowsocks
- Легковесный протокол
- Быстрая работа

## Клиентские приложения

### Windows
- **v2rayN** - Полнофункциональный клиент
- **Qv2ray** - Кроссплатформенный клиент
- **Clash for Windows** - Современный клиент

### macOS
- **V2rayU** - Простой клиент для macOS
- **Qv2ray** - Кроссплатформенный клиент
- **ClashX** - Современный клиент

### Android
- **V2rayNG** - Популярный клиент
- **SagerNet** - Многофункциональный клиент
- **Clash for Android** - Современный клиент

### iOS
- **Shadowrocket** - Платный клиент
- **OneClick** - Бесплатный клиент
- **Stash** - Современный клиент

### Linux
- **Qv2ray** - GUI клиент
- **V2rayA** - Веб-интерфейс
- **Clash** - Командная строка

## Управление пользователями

### Добавление пользователей
1. Отредактируйте `config.cfg`
2. Добавьте новых пользователей в список `users`
3. Запустите: `./deploy update-users`

### Удаление пользователей
1. Отредактируйте `config.cfg`
2. Удалите пользователей из списка `users`
3. Запустите: `./deploy update-users`

## Безопасность

### Рекомендации
- Регулярно обновляйте сервер
- Используйте сильные пароли для SSH
- Настройте fail2ban для защиты от брутфорса
- Мониторьте логи на подозрительную активность

### Мониторинг
```bash
# Проверка статуса сервисов
systemctl status xray

# Просмотр логов
journalctl -u xray -f

# Мониторинг подключений
ss -tulpn | grep :443
```

## Устранение неполадок

### Проблемы с подключением
1. Проверьте статус сервиса: `systemctl status xray`
2. Проверьте логи: `journalctl -u xray -f`
3. Проверьте файрвол: `ufw status`
4. Проверьте порты: `ss -tulpn | grep :443`

### Проблемы с производительностью
1. Проверьте нагрузку: `htop`
2. Проверьте сеть: `iftop`
3. Проверьте диски: `df -h`

### Проблемы с конфигурацией
1. Проверьте синтаксис JSON: `xray -test -config /etc/xray/config.json`
2. Перезапустите сервис: `systemctl restart xray`
3. Проверьте права доступа: `ls -la /etc/xray/`

## Дополнительные возможности

### Веб-панель управления
Включите в `config.cfg`:
```yaml
web_panel:
  enabled: true
  port: 2053
  username: "admin"
  password: "your_password"
```

### Блокировка рекламы
Включите в `config.cfg`:
```yaml
dns:
  adblock_enabled: true
```

### IPv6 поддержка
Включите в `config.cfg`:
```yaml
network:
  ipv6_enabled: true
```

## Поддержка

Если у вас возникли проблемы:
1. Проверьте документацию
2. Посмотрите логи сервера
3. Создайте issue в GitHub репозитории
4. Обратитесь к сообществу

## Лицензия

Проект распространяется под лицензией AGPLv3.
