---
- name: Backup VPN Server
  hosts: "{{ target_hosts | default('vpn_servers') }}"
  become: true
  gather_facts: true
  
  tasks:
    - name: Create backup
      include_role:
        name: backup
      tags: [backup]
    
    - name: Upload backup to cloud storage
      include_role:
        name: backup
        tasks_from: cloud-upload
      when: backup.cloud_storage.enabled | default(false)
      tags: [backup, cloud]
    
    - name: Verify backup integrity
      include_role:
        name: backup
        tasks_from: verify
      tags: [backup, verify]
